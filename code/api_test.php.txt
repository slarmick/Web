<?php
// –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç API –±–µ–∑ —Å–µ—Å—Å–∏–π –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–µ–π
class ApiClient {
    public function request(string $url): array {
        try {
            // –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ API
            $response = file_get_contents($url, false, stream_context_create([
                'ssl' => [
                    'verify_peer' => false,
                    'verify_peer_name' => false,
                ],
                'http' => [
                    'timeout' => 15,
                    'ignore_errors' => true
                ]
            ]));
            
            if ($response === false) {
                throw new Exception('–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API');
            }
            
            $data = json_decode($response, true);
            
            if (json_last_error() !== JSON_ERROR_NONE) {
                throw new Exception('–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è JSON: ' . json_last_error_msg());
            }
            
            if (!isset($data['data'])) {
                throw new Exception('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API');
            }
            
            return $data;
            
        } catch (\Exception $e) {
            return [
                'data' => [],
                'pagination' => ['total' => 0],
                'error' => $e->getMessage()
            ];
        }
    }
}

$api = new ApiClient();
$url = 'https://api.artic.edu/api/v1/artworks?limit=5&fields=title,artist_display,medium_display,date_display';

echo "<!DOCTYPE html>";
echo "<html lang='ru'>";
echo "<head>";
echo "<meta charset='UTF-8'>";
echo "<meta name='viewport' content='width=device-width, initial-scale=1.0'>";
echo "<title>–¢–µ—Å—Ç API</title>";
echo "<style>";
echo "body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }";
echo ".container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }";
echo ".artwork { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #3498db; }";
echo ".artwork-title { font-weight: bold; color: #2c3e50; font-size: 1.1em; }";
echo ".artwork-artist { color: #3498db; font-style: italic; }";
echo ".artwork-technique { color: #e74c3c; font-weight: bold; }";
echo ".success { background: #d4edda; padding: 15px; border-radius: 5px; color: #155724; }";
echo ".error { background: #f8d7da; padding: 15px; border-radius: 5px; color: #721c24; }";
echo ".info { background: #d1ecf1; padding: 15px; border-radius: 5px; color: #0c5460; }";
echo "</style>";
echo "</head>";
echo "<body>";
echo "<div class='container'>";
echo "<h1>üß™ –¢–µ—Å—Ç API Art Institute of Chicago</h1>";
echo "<div class='info'>";
echo "<p><strong>URL:</strong> $url</p>";
echo "<p><strong>–í—Ä–µ–º—è:</strong> " . date('Y-m-d H:i:s') . "</p>";
echo "</div>";

$result = $api->request($url);

if (isset($result['error'])) {
    echo "<div class='error'>";
    echo "<h3>‚ùå –û—à–∏–±–∫–∞ API</h3>";
    echo "<p><strong>–°–æ–æ–±—â–µ–Ω–∏–µ:</strong> " . htmlspecialchars($result['error']) . "</p>";
    echo "</div>";
} else {
    $artworkCount = count($result['data'] ?? []);
    $total = $result['pagination']['total'] ?? 0;
    
    echo "<div class='success'>";
    echo "<h3>‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ</h3>";
    echo "<p><strong>–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–π:</strong> $artworkCount</p>";
    echo "<p><strong>–í—Å–µ–≥–æ –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏:</strong> $total</p>";
    echo "</div>";

    if ($artworkCount > 0) {
        echo "<h2>üñºÔ∏è –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:</h2>";
        foreach ($result['data'] as $index => $artwork) {
            echo "<div class='artwork'>";
            echo "<div class='artwork-title'>" . ($index + 1) . ". " . htmlspecialchars($artwork['title'] ?? '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è') . "</div>";
            echo "<div class='artwork-artist'>üë®‚Äçüé® " . htmlspecialchars($artwork['artist_display'] ?? '–ê–≤—Ç–æ—Ä –Ω–µ —É–∫–∞–∑–∞–Ω') . "</div>";
            if (!empty($artwork['date_display'])) {
                echo "<div>üìÖ " . htmlspecialchars($artwork['date_display']) . "</div>";
            }
            echo "<div class='artwork-technique'>üé® " . htmlspecialchars($artwork['medium_display'] ?? '–¢–µ—Ö–Ω–∏–∫–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞') . "</div>";
            echo "</div>";
        }
    } else {
        echo "<div class='error'>";
        echo "<p>‚ö†Ô∏è –ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –æ—Ç–≤–µ—Ç–µ API</p>";
        echo "</div>";
    }
}

echo "<div style='margin-top: 20px;'>";
echo "<a href='/'' style='background: #3498db; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;'>üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a>";
echo " <a href='/master-class.html' style='background: #27ae60; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px;'>üìù –¢–µ—Å—Ç —Ñ–æ—Ä–º—ã</a>";
echo "</div>";

echo "<div style='margin-top: 20px; font-size: 0.9em; color: #666;'>";
echo "<h3>üîß –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Ä–≤–µ—Ä–µ:</h3>";
echo "<ul>";
echo "<li><strong>PHP Version:</strong> " . phpversion() . "</li>";
echo "<li><strong>allow_url_fopen:</strong> " . (ini_get('allow_url_fopen') ? '‚úÖ –í–∫–ª—é—á–µ–Ω–æ' : '‚ùå –í—ã–∫–ª—é—á–µ–Ω–æ') . "</li>";
echo "<li><strong>SSL:</strong> " . (extension_loaded('openssl') ? '‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ' : '‚ùå –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ') . "</li>";
echo "</ul>";
echo "</div>";

echo "</div>";
echo "</body>";
echo "</html>";
?>